---
title: "June 21, 2022, Day04"
output: 
  html_document:
    keep_md: true
date: '2022-06-21'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## chapter.6

### 데이터 전처리
  - 분석 프로세스
  - 데이터 전처리를 위한 도구: dplyr
  - 데이터 전처리를 위한 도구: data.table
```
## 처리속도 차이
# dplyr : 10GB 이내
# data.table: 50GB 이상

# 배움의 측면
# dplyr -> 매우 쉬움
# data.table -> 어려움
```
  - 라이브러리 불러오기
```
install.packages("dplyr")
library("dplyr")

```

### 변수이름 바꾸기
  - rename() 함수는 데이터세트에 있는 변수이름을 변경
```{r}
mpg1_newname1 <- mpg1 %>%  
    rename(transmission=trans,
           drive_method=drv,
           city=cty,
           highway=hwy)
```
```{r}
mpg1_newname2 <- rename(mpg1, transmission=trans,
                        drive_method=drv,
                        city=cty,
                        highway=hwy)
str(mpg1_newname2)
```

### 빈도분석 : count()
```
count(데이터세트,변수)
table(데이터세트$변수)
```
```{r}
count(mpg1,trans)

class(count(mpg1, trans))
# 데이터 유형은 데이터 프레임

table(mpg1$trans)

class(table(mpg1$trans))
#데이터 유형은 테이블
```

### 데이터세트에서 일부 열 출력하기 : select()
  - 일부 열 추출하거나 불필요한 열 삭제 시
  1) 필요한 열 추출
```{r}
mpg1_1 <- mpg1 %>% select(manufacturer, trans, cty)
mpg1_1
str(mpg1_1)

mpg1_2 <- select(mpg1, manufacturer, trans, cty)
str(mpg1_2)
```
  2) 불필요한 열 삭제
```{r}
mpg1_type1 <- mpg1 %>% select(-cty,-hwy)

mpg1_type2 <- select(mpg1, -cty, -hwy)

mpg1_type3 <- mpg1 %>% select(-c(cty, hwy))

mpg1_type4 <- select(mpg1, -c(cty, hwy))
```

### 데이터세트에서 행 추출: slice(), filter()
  1) 행의 일부를 추출 : slice()
```{r}
mpg1 %>% slice(1,4,5)
slice(mpg1,1,4,5)
```

  2) 조건에 맞는 행 추출: filter()
  (1) 비교값이 같은 데이터 추출
```{r}
mpg1_hd1 <- mpg1 %>% filter(manufacturer == "hyundai")
str(mpg1_hd1)

mpg1_hd2 <- filter(mpg1, manufacturer == "hyundai")
```
  
  (2) 비교값이 다른 데이터 추출
```{r}
mpg1_hd3 <- mpg1 %>% filter(manufacturer != "hyundai")
str(mpg1_hd3)

mpg1_hd4 <- filter(mpg1, manufacturer != "hyundai")
```
  
  (3) 비교값이 크거나 작은 데이터 추출
```{r}
# 비교값이 작은 데이터
mean(mpg1$cty)

mpg1_low1 <- mpg1 %>% filter(cty < 16.85897)
str(mpg1_low1)

mpg1_low2 <- filter(mpg1, cty < 16.85897)

mpg1_low3 <- mpg1 %>% filter(cty < mean(cty))
```
```{r}
# 비교값이 작거나 같은 데이터
quantile(mpg1$cty)

mpg1_low4 <- mpg1 %>% filter(cty <= 14)
str(mpg1_low4)

mpg1_low5 <- filter(mpg1, cty <= 14)
```
  -> 이런 식으로 기준이 되는 값을 구한 뒤, 크거나 같은 데이터에도
    filter() 함수를 이용하여 똑같이 적용하면 된다

  (4) 복수의 조건을 충족하는 데이터 추출 : & 이용
```
1. 조건이 2개일 때 예시
mpg1_hd3 <- mpg1 %>% filter(manufacturer == "hyundai" & cty >= mean(cty))
mpg1_hd4 <- filter(mpg1, manufacturer == "hyundai" & cty >= mean(cty))

2. 조건이 3개일 때 예시
mpg1_hd5 <- mpg1 %>% filter(manufacturer == "hyundai" & trans == "auto" & cty >= median(cty))
mpg1_hd6 <- filter(mpg1, manufacturer == "hyundai" & trans == "auto" & cty >= mean(cty))
```
  (5) 복수 조건 중 하나라도 충족하는 데이터 추출 : | 이용
```
ex. mpg1_j1 <- mpg1 %>% filter(manufacturer == "hyundai | manufacturer == "nissan" | manufacturer == "subaru" | manufacturer == "toyota")
  
    mpg1_j1 <- filter(mpg1, manufacturer == "hyundai | manufacturer == "nissan" | manufacturer == "subaru" | manufacturer == "toyota")
    
'|'로 연결할 내용이 너무 많을 경우 %in% c()를 이용
ex. mpg1_j3 <- mpg1 %>% filter(manufacturer %in% c("honda", "nisasn", "subaru", "toyota"))
```
  (6) 열을 추출한 후 조건에 맞는 행 추출
```{r}
# 예시
mpg1_h9 <- mpg %>%
  select(manufacturer, cty) %>% 
  filter(manufacturer == "hyundai", cty >= 16.85897)
str(mpg1_h9)
```

```{r}
# 조금 결이 다른 예시(조건 수행 후 열 추출 반복)
iris %>%
  # species, setosa, versicolor
  filter(Species != "virginica") %>% 
  select(Sepal.Length, Sepal.Width) %>% 
  filter(Sepal.Length > 5.0) %>% 
  mutate(total = Sepal.Length + Sepal.Width) -> data2

str(data2)
```

### 파생변수 만들기 : mutate()
  - 1개의 파생변수 만들기
```{r}
mpg2 <- mpg1 %>% 
  mutate(total = cty+hwy)

str(mpg2)
```
```{r}
mpg1$total <- mpg1$cty + mpg1$hwy
mpg1$mean <- (mpg1$cty + mpg1$hwy)/2

str(mpg1)
```

  - 복수의 파생변수 만들기
```{r}
mpg3 <- mpg1 %>% 
  mutate(total = cty + hwy
         , mean = (cty+hwy)/2)
str(mpg3)
```


### 집단별 통계량 구하기 : group_by(), summarise(), n()
  - 집단 분류 : group_by() 함수
```{r}
mpg1 %>% group_by(trans)
```
  - 집단의 통계 구하기 : summarize() 함수
```{r}
# 한 개의 명령을 수행할 때
mpg1 %>% summarise(m=mean(cty))   # 데이터 프레임 형식으로 출력

mean(mpg1$cty)   # 결과를 바로 출력
```

```{r}
# 여러 개의 명령을 동시에 수행할 때
mpg1 %>% summarise(m=mean(cty), s=sum(cty), med=median(cty))

mpg1 %>% summarise(mean(cty), sum(cty), median(cty))
```

  - 집단으로 분류해서 집단별 통계 구하기
```{r}
mpg1 %>% 
  group_by(trans) %>% 
  summarise(avg     = mean(cty)
            , total = sum(cty)
            , med   = median(cty))
```
```{r}
mpg1 %>% 
  group_by(trans, drv) %>% 
  summarise(avg     = mean(cty)
            , total = sum(cty))
```

  - 집단별 빈도와 비율 구하기  
  1) 분류 집단별 데이터 빈도 구하기 : group_by(변수)+summarise(n()함수)
    -> n() 함수 : 집단의 데이터 숫자를 세어 빈도를 알려주는 함수
```{r}
mpg1 %>% 
  group_by(trans) %>% 
  summarise(n=n())      # 변수이름 = n()
```
```{r}
mpg1 %>% 
  group_by(trans, drv) %>% 
  summarize(avg     = mean(cty)
            , total = sum(cty)
            , med   = median(cty)
            , count = n())
```

